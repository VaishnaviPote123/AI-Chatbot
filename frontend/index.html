<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eco Coach Chatbot üå±</title>
<style>
  * { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
  body { margin: 0; background: #f4fdf6; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 10px; }
  .app-container { width: 600px; max-width: 95%; background: #ffffff; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
  .app-header { background: linear-gradient(135deg, #2ecc71, #27ae60); color: white; padding: 20px; border-radius: 16px 16px 0 0; text-align: center; font-size: 22px; font-weight: bold; }

  /* Tabs */
  .tabs { display: flex; border-bottom: 2px solid #e0e0e0; }
  .tab-button { flex: 1; padding: 12px; background: #f9fffb; border: none; cursor: pointer; font-weight: bold; border-bottom: 3px solid transparent; transition: all 0.3s; }
  .tab-button.active { background: #e8f5e9; color: #2ecc71; border-bottom-color: #2ecc71; }
  .tab-button:hover { background: #f0f8f4; }
  .tab-content { display: none; padding: 20px; flex: 1; max-height: 500px; overflow-y: auto; }
  .tab-content.active { display: block; }

  /* Chat */
  .chat-messages { height: 320px; overflow-y: auto; background: #f0fff4; border-radius: 15px; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
  .message { display: inline-block; padding: 12px 16px; border-radius: 20px; max-width: 75%; font-size: 14px; position: relative; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  .message .msg-text { display: block; }
  .message .msg-time { font-size: 10px; color: #555; position: absolute; bottom: -12px; right: 10px; }
  .user { background: #2ecc71; color: white; margin-left: auto; border-bottom-right-radius: 0; }
  .bot { background: #e0f5e9; color: #333; margin-right: auto; border-bottom-left-radius: 0; }
  .chat-input { display: flex; gap: 8px; margin-top: 10px; }
  .chat-input input { flex: 1; padding: 12px; border-radius: 25px; border: 1px solid #ccc; font-size: 14px; }
  .chat-input button { padding: 12px 18px; border-radius: 25px; background: #27ae60; color: white; border: none; font-weight: bold; }
  .chat-input button:hover { background: #2ecc71; }

  /* Challenge */
  .challenge-card { background: #e8f5e9; padding: 15px; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid #2ecc71; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
  .challenge-title { font-weight: bold; color: #2ecc71; font-size: 16px; }
  .challenge-desc { font-size: 14px; color: #555; margin: 5px 0; }
  .challenge-value { font-size: 13px; color: #27ae60; font-weight: bold; }
  .challenge-btn { width: 100%; padding: 10px; border: none; border-radius: 8px; background: #2ecc71; color: white; font-weight: bold; cursor: pointer; }
  .challenge-btn:hover { background: #27ae60; }

  /* Tracker */
  .stat-box { background: #e8f5e9; padding: 15px; border-radius: 12px; margin-bottom: 10px; text-align: center; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }
  .stat-label { font-size: 12px; color: #666; }
  .stat-value { font-size: 22px; font-weight: bold; color: #2ecc71; margin-top: 5px; }
  .log-form { display: flex; flex-direction: column; gap: 10px; }
  .log-form input, .log-form select { padding: 10px; border-radius: 8px; border: 1px solid #ccc; }
  .log-form button { padding: 10px; background: #2ecc71; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
  .log-form button:hover { background: #27ae60; }

  /* Reminders */
  .reminder-card { background: #e8f5e9; padding: 12px; border-radius: 12px; margin-bottom: 10px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); }

  /* Leaderboard */
  .leaderboard-list { list-style: none; padding: 0; margin: 0; }
  .leaderboard-item { display: flex; justify-content: space-between; padding: 12px; background: #f9fffb; margin-bottom: 8px; border-radius: 10px; border-left: 4px solid #2ecc71; box-shadow: 0 1px 3px rgba(0,0,0,0.06); }
</style>
</head>

<body>
<div class="app-container">
  <div class="app-header">üå± Eco Lifestyle Coach</div>

  <div class="tabs">
    <button class="tab-button active" onclick="switchTab(event,'chat')">üí¨ Chat</button>
    <button class="tab-button" onclick="switchTab(event,'challenge')">üéØ Challenge</button>
    <button class="tab-button" onclick="switchTab(event,'tracker')">üìä Tracker</button>
    <button class="tab-button" onclick="switchTab(event,'reminders')">üîî Reminders</button>
    <button class="tab-button" onclick="switchTab(event,'leaderboard')">üèÜ Board</button>
  </div>

  <!-- Chat Tab -->
  <div id="chat" class="tab-content active">
    <div id="chatMessages" class="chat-messages">
      <div class="message bot"><span class="msg-text">Hello! I am your Eco Coach üåç</span><span class="msg-time">Now</span></div>
    </div>
    <div class="chat-input">
      <input id="userInput" placeholder="Ask me anything...">
      <button onclick="sendMessage()">Send</button>
    </div>
    <input id="username" placeholder="Your name (optional)" style="margin-top:10px;width:100%">
  </div>

  <!-- Challenge Tab -->
  <div id="challenge" class="tab-content">
    <h2>Today's Challenge üéØ</h2>
    <div id="challengeCard">
      <button onclick="loadChallenge()" class="challenge-btn">Load Today's Challenge</button>
    </div>
  </div>

  <!-- Tracker Tab -->
  <div id="tracker" class="tab-content">
    <input id="trackerUsername" placeholder="Your name" style="margin-bottom:10px">
    <button onclick="loadUserStats()" class="challenge-btn" style="margin-bottom:10px">Load Stats</button>
    <div id="userStats"></div>

    <h3>Log Activity</h3>
    <div class="log-form">
      <input id="logUsername" placeholder="Your name">
      <input id="logActivity" placeholder="Activity (e.g., Used public transport)">
      <input type="number" id="logCarbon" placeholder="Carbon saved (kg)" step="0.1">
      <button onclick="logCarbon()">Log Activity</button>
    </div>
    <div id="logMessage"></div>
  </div>

  <!-- Reminders Tab -->
  <div id="reminders" class="tab-content">
    <input id="reminderUsername" placeholder="Your name" style="margin-bottom:10px">
    <button onclick="loadReminders()" class="challenge-btn" style="margin-bottom:10px">Load Reminders</button>
    <div id="remindersList"></div>

    <h3>Add Reminder</h3>
    <div class="log-form">
      <input id="newReminderUsername" placeholder="Your name">
      <input id="newHabit" placeholder="Habit (e.g., Drink water)">
      <select id="reminderFrequency">
        <option value="daily">Daily</option>
        <option value="weekly">Weekly</option>
        <option value="hourly">Hourly</option>
      </select>
      <button onclick="addNewReminder()">Add Reminder</button>
    </div>
    <div id="reminderMessage"></div>
  </div>

  <!-- Leaderboard Tab -->
  <div id="leaderboard" class="tab-content">
    <button onclick="loadLeaderboard()" class="challenge-btn" style="margin-bottom:10px">Refresh</button>
    <ul id="leaderboardList" class="leaderboard-list"></ul>
  </div>
</div>

<script>
const BASE_URL = "https://ai-chatbot-9vkx.onrender.com";

/* Tabs */
function switchTab(event, tabName){
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
  document.getElementById(tabName).classList.add('active');
  event.target.classList.add('active');
  if(tabName==='challenge') loadChallenge();
  if(tabName==='leaderboard') loadLeaderboard();
}

/* Chat */
function addMessage(text,sender){
  const chat=document.getElementById('chatMessages');
  const div=document.createElement('div');
  div.className=`message ${sender}`;
  div.innerHTML=`<span class="msg-text">${text}</span><span class="msg-time">${new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</span>`;
  chat.appendChild(div);
  chat.scrollTop=chat.scrollHeight;
}
function sendMessage(){
  const input=document.getElementById('userInput');
  const username=document.getElementById('username').value||'guest';
  const message=input.value.trim(); if(!message)return;
  addMessage(message,'user'); input.value='';
  fetch(`${BASE_URL}/chat`,{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username,message})
  }).then(res=>res.json())
    .then(data=>addMessage(data.reply,'bot'))
    .catch(()=>addMessage("Server not responding üòï",'bot'));
}

/* Challenge */
function loadChallenge(){
  fetch(`${BASE_URL}/challenge/daily`).then(res=>res.json())
    .then(data=>{
      document.getElementById('challengeCard').innerHTML=`
      <div class="challenge-card">
        <div class="challenge-title">${data.title}</div>
        <div class="challenge-desc">${data.description}</div>
        <div class="challenge-value">üíö ${data.carbon_value} kg CO‚ÇÇ</div>
        <button class="challenge-btn" onclick="completeChallenge(${data.carbon_value},'${data.title}')">Complete Challenge</button>
      </div>`;
    });
}
function completeChallenge(carbon,title){
  const username=prompt("Enter your name to complete challenge:"); if(!username)return;
  fetch(`${BASE_URL}/carbon/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,carbon_saved:carbon,activity:title})})
  .then(()=>{alert("üéâ Challenge completed!"); loadLeaderboard();});
}

/* Tracker */
function loadUserStats(){
  const username=document.getElementById('trackerUsername').value;
  if(!username)return alert("Enter name");
  fetch(`${BASE_URL}/user/${username}`).then(res=>res.json())
    .then(data=>{
      document.getElementById('userStats').innerHTML=`
      <div class="stat-box"><div class="stat-label">Total Carbon Saved</div><div class="stat-value">${data.total_carbon_saved} kg</div></div>
      <div class="stat-box"><div class="stat-label">Streak</div><div class="stat-value">${data.streak}</div></div>`;
    });
}
function logCarbon(){
  const username=document.getElementById('logUsername').value;
  const activity=document.getElementById('logActivity').value;
  const carbon=parseFloat(document.getElementById('logCarbon').value);
  if(!username||!activity||!carbon)return alert("Fill all fields");
  fetch(`${BASE_URL}/carbon/log`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,carbon_saved:carbon,activity})})
  .then(res=>res.json()).then(data=>{document.getElementById('logMessage').innerHTML=`‚úÖ ${data.message}`; document.getElementById('logUsername').value=''; document.getElementById('logActivity').value=''; document.getElementById('logCarbon').value='';});
}

/* Reminders */
function loadReminders(){
  const username=document.getElementById('reminderUsername').value; if(!username)return alert("Enter name");
  fetch(`${BASE_URL}/reminders/${username}`).then(res=>res.json())
    .then(data=>{
      const list=document.getElementById('remindersList');
      if(!data.length){list.innerHTML="<p>No reminders yet</p>"; return;}
      list.innerHTML=data.map(r=>`<div class="reminder-card"><b>${r.habit}</b><p>Frequency: ${r.frequency}</p></div>`).join('');
    });
}
function addNewReminder(){
  const username=document.getElementById('newReminderUsername').value;
  const habit=document.getElementById('newHabit').value;
  const frequency=document.getElementById('reminderFrequency').value;
  if(!username||!habit)return alert("Fill all fields");
  fetch(`${BASE_URL}/reminder/add`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username,habit,frequency})})
  .then(res=>res.json()).then(()=>{alert("Reminder added!"); document.getElementById('reminderUsername').value=username; loadReminders();});
}

/* Leaderboard */
function loadLeaderboard(){
  fetch(`${BASE_URL}/leaderboard`).then(res=>res.json())
    .then(data=>{
      const list=document.getElementById('leaderboardList');
      if(!data.length){list.innerHTML="<li>No data yet</li>"; return;}
      list.innerHTML=data.map((u,i)=>`<li class="leaderboard-item"><span>#${i+1} ${u.username}</span><span>${u.total_carbon_saved} kg</span></li>`).join('');
    });
}

/* Auto-load leaderboard */
loadLeaderboard();
</script>
</body>
</html>
